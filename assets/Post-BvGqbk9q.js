import{d as Z,u as ee,E as ie,o as n,b as d,j as m,g as D,w as _,G as de,t as E,h as p,f as e,e as R,m as y,F as q,i as te,x as C,P as M,s as me,Q as ve,H as F,r as f,c as V,B as pe,p as U,a as ce,q as ye,N as fe,_ as G,D as be,n as H,k as I,v as S,l as Q,M as J,R as K,z as he,T as ge}from"./index-B2yev03a.js";import{A as X}from"./AppTile-BycuUR1q.js";import{g as ke,a as we,_ as Ce,t as Y}from"./PostTile.vue_vue_type_script_setup_true_lang-DV2jephg.js";import{L as $e}from"./Loading-DFgC3aiS.js";const Pe={class:"my-2"},_e={key:1},De={key:2,class:"text-primary mx-1 pointer","data-toggle":"tooltip","data-placement":"top",title:"This user is the Original Poster"},Ee={key:0},xe={key:1,class:"ms-4"},oe=Z({__name:"Comment",props:{id:{},author:{},isPoster:{type:Boolean},date:{},body:{},comments:{},score:{},vote:{type:[Boolean,null]}},setup(W){const r=W,b=ee(),x=async a=>{var B;if(!((B=b.value)!=null&&B.uid)||!y.id)return;const l=C(M,r.id),w=await me(l);if(!w.exists()){console.error("Cannot vote - comment no longer exists");return}const u=w.data(),{score:c,ups:k,downs:$}=ve(a,u.up||[],u.down||[],u.score||0,y.id);try{F(l,{score:c,up:k,down:$})}catch(h){console.error(h)}};return(a,l)=>{const w=ie("RouterLink");return n(),d("div",null,[m("div",Pe,[r.author?(n(),D(w,{key:0,to:`/u/${r.author}`},{default:_(()=>[de(E(r.author),1)]),_:1},8,["to"])):(n(),d("span",_e,"[deleted]")),a.isPoster?(n(),d("span",De,"OP")):p("",!0),m("span",null," â€¢ "+E(e(ke)(a.date)),1),m("p",null,E(r.body),1),R(we,{onVote:l[0]||(l[0]=u=>x(u)),score:r.score||0,vote:r.vote},null,8,["score","vote"]),e(b)?(n(),d("button",{key:3,class:"btn btn-primary mx-2",onClick:l[1]||(l[1]=u=>a.$emit("reply",r.id))},"Reply")):p("",!0),e(b)&&a.author===e(y).id?(n(),d("button",{key:4,class:"btn btn-secondary mx-2",onClick:l[2]||(l[2]=u=>a.$emit("edit",r.id,r.body))},"Edit")):p("",!0),e(b)&&a.author===e(y).id?(n(),d("button",{key:5,class:"btn btn-danger mx-2",onClick:l[3]||(l[3]=u=>a.$emit("delete",r.id))},"Delete")):p("",!0)]),r.comments&&r.comments.length>0?(n(),d("hr",Ee)):p("",!0),r.comments&&r.comments.length>0?(n(),d("div",xe,[(n(!0),d(q,null,te(r.comments,u=>(n(),D(oe,{onReply:l[4]||(l[4]=c=>a.$emit("reply",c)),onEdit:l[5]||(l[5]=(c,k)=>a.$emit("edit",c,k)),onDelete:l[6]||(l[6]=c=>a.$emit("delete",c)),id:u.id,author:u.author||null,"is-poster":u.isPoster,date:u.date,body:u.body,comments:u.comments||[],score:u.score||0,vote:e(b)?u.vote:null},null,8,["id","author","is-poster","date","body","comments","score","vote"]))),256))])):p("",!0)])}}}),Be=m("h1",null,"Post not found",-1),Te={class:"form-group"},Me=m("label",{for:"postName"},"Post Title",-1),Ve={key:0,class:"form-text text-danger"},Re={class:"form-group"},Ne=m("label",{for:"postBody"},"Post Body",-1),Le={key:0,class:"form-text text-danger"},Ue=m("button",{class:"btn btn-primary my-2",type:"submit"},"Continue",-1),Ie={class:"form-group"},Se=m("label",{for:"commentBody"},"Comment",-1),qe={key:0,class:"form-text text-danger"},Fe=m("button",{class:"btn btn-primary my-2",type:"submit"},"Continue",-1),ze=Z({__name:"Post",setup(W){const r=be(),b=f(!0),x=f(!0),a=ee(),l=f("Write a comment"),w=V(()=>a.value?new J("#commentModal"):null),u=V(()=>a.value?new J("#postEditModal"):null),c=f(),k=f(),$=f(),B=f(),h=V(()=>r.params.post&&typeof r.params.post=="string"?r.params.post:null),{data:i,promise:se}=pe(h.value?C(U,h.value):null);se.value.then(()=>{b.value=!1,c.value=i.value.title,$.value=i.value.content});const{data:A,promise:ne}=ce(h.value?ye(M,fe("post","==",h.value)):null);ne.value.then(()=>x.value=!1);const O=V(()=>A.value?j(A.value):null),j=(v,t)=>{const o=v.filter(s=>t?s.parent===t:!s.parent).map(s=>{var P;return{id:s.id,author:s.author,isPoster:s.author===((P=i.value)==null?void 0:P.author),date:Y(s.created)||new Date,body:s.content,score:s.score||0,vote:a&&y.id?H(s.up||[],s.down||[],y.id):null,comments:j(v,s.id)}});return o.sort((s,P)=>s.date>P.date?-1:1),o},ae=async()=>{var v;if(h.value){if(!c.value||c.value.trim().length===0){k.value="Post name required.";return}try{await F(C(U,h.value),{title:c.value,content:$.value}),(v=u.value)==null||v.hide()}catch(t){console.error(t),k.value="Something went wrong. Please try again later."}}},z=f(null),N=f(null),g=f(),T=f(),L=(v,t,o)=>{var s;z.value=v,N.value=t||null,o?(l.value="Edit comment",g.value=o):(l.value="Write a comment",g.value=""),(s=w.value)==null||s.show()},le=async()=>{var v;if(!(!a.value||!y.id||!h.value)){if(!g.value||g.value.trim().length===0){T.value="Comment required.";return}try{N.value?await F(C(M,N.value),{content:g.value}):await he(C(M),{author:y.id,uid:y.uid,created:ge.fromDate(new Date),post:h.value,content:g.value,parent:z.value}),(v=w.value)==null||v.hide()}catch(t){T.value="Something went wrong. Please try again later.",console.error(t)}finally{g.value="",T.value=""}}},re=async()=>{if(i.value)try{await K(C(U,i.value.id))}catch(v){console.error(v)}},ue=async v=>{try{await K(C(M,v))}catch(t){console.error(t)}};return(v,t)=>(n(),d(q,null,[!b.value&&e(i)?(n(),D(Ce,{key:0,postId:e(i).id,subview:`${e(i).subview}`,title:`${e(i).title}`,date:e(Y)(e(i).created),author:`${e(i).author}`,body:`${e(i).content}`,score:e(i).score||0,vote:e(a)&&e(y).id?e(H)(e(i).up||[],e(i).down||[],e(y).id):null},{default:_(()=>[e(a)?(n(),d("button",{key:0,onClick:t[0]||(t[0]=()=>L(null)),class:"btn btn-primary mx-2"}," Comment ")):p("",!0),e(a)&&e(i).author===e(y).id?(n(),d("button",{key:1,onClick:t[1]||(t[1]=()=>{var o;return(o=u.value)==null?void 0:o.show()}),class:"btn btn-secondary mx-2"}," Edit ")):p("",!0),e(a)&&e(i).author===e(y).id?(n(),d("button",{key:2,onClick:t[2]||(t[2]=()=>re()),class:"btn btn-danger mx-2"}," Delete ")):p("",!0)]),_:1},8,["postId","subview","title","date","author","body","score","vote"])):!b.value&&!e(i)?(n(),D(X,{key:1},{default:_(()=>[Be]),_:1})):p("",!0),b.value||x.value?(n(),D($e,{key:2})):p("",!0),!x.value&&e(i)&&O.value?(n(!0),d(q,{key:3},te(O.value,o=>(n(),D(X,{class:"overflow-x-auto"},{default:_(()=>[R(oe,{onReply:t[3]||(t[3]=s=>L(s)),onEdit:t[4]||(t[4]=(s,P)=>L(null,s,P)),onDelete:t[5]||(t[5]=s=>ue(s)),id:o.id,author:o.author,isPoster:o.isPoster,date:o.date,body:o.body,comments:o.comments||[],score:o.score,vote:e(a)?o.vote:null},null,8,["id","author","isPoster","date","body","comments","score","vote"])]),_:2},1024))),256)):p("",!0),R(G,{id:"postEditModal",title:"Edit post"},{default:_(()=>[m("form",{onSubmit:Q(ae,["prevent"]),novalidate:""},[m("div",Te,[Me,I(m("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>c.value=o),id:"postName",class:"form-control",name:"postName",placeholder:"Post Title"},null,512),[[S,c.value]]),k.value?(n(),d("small",Ve,E(k.value),1)):p("",!0)]),m("div",Re,[Ne,I(m("textarea",{"onUpdate:modelValue":t[7]||(t[7]=o=>$.value=o),id:"postBody",class:"form-control",name:"postBody",placeholder:"What are your thoughts?"},null,512),[[S,$.value]]),B.value?(n(),d("small",Le,E(B.value),1)):p("",!0)]),Ue],32)]),_:1}),R(G,{id:"commentModal",title:l.value},{default:_(()=>[m("form",{onSubmit:Q(le,["prevent"]),novalidate:""},[m("div",Ie,[Se,I(m("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>g.value=o),class:"form-control",id:"commentBody",name:"commentBody",placeholder:"What do you think?"},null,512),[[S,g.value]]),T.value?(n(),d("small",qe,E(T.value),1)):p("",!0)]),Fe],32)]),_:1},8,["title"])],64))}});export{ze as default};
