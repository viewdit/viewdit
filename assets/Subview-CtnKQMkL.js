import{d as W,u as K,r as d,c as y,B as X,x as D,y as L,a as Y,b as l,e as C,w as m,_ as Z,f as s,g as w,F as U,i as ee,C as te,D as se,E,o as n,j as o,t as h,G as B,h as p,k as j,v as q,l as oe,m as u,n as ae,M as ne,q as re,p as A,s as ue,H as le,z as ie,T as de}from"./index-B2yev03a.js";import{f as ce,t as me,_ as pe}from"./PostTile.vue_vue_type_script_setup_true_lang-DV2jephg.js";import{L as ve}from"./Loading-DFgC3aiS.js";import{A as F}from"./AppTile-BycuUR1q.js";import{g as O,a as fe,_ as be,b as _e}from"./query-y6O2yjs3.js";const ye={key:0},we={class:"d-inline"},he={class:"mx-2"},ge={key:1},ke=o("h1",null,"No Subview found",-1),xe=o("p",null,"No subview goes by that name.",-1),Pe=[ke,xe],Ce={class:"form-group"},Ne=o("label",{for:"postName"},"Post Title",-1),De={key:0,class:"form-text text-danger"},Be={class:"form-group"},Se=o("label",{for:"postBody"},"Post Body",-1),Ve={key:0,class:"form-text text-danger"},Re=o("button",{class:"btn btn-primary my-2",type:"submit"},"Continue",-1),Te=o("h1",null,"No Posts",-1),Me=o("p",null,"No posts found.",-1),Fe=W({__name:"Subview",setup($e){const v=K();te();const g=d(!0),f=se(),S=y(()=>v.value?new ne("#postModal"):null),b=d(),k=d(),N=d(""),V=d(),r=y(()=>f.params.subview&&typeof f.params.subview=="string"?f.params.subview:null),{data:_,promise:z}=X(r.value?D(L,r.value):null);z.value.then(()=>g.value=!1);const R=d(O("","New","Post title only",r.value)),{data:x,promise:Le}=Y(y(()=>re(A,...R.value))),G=(a,e,i)=>{R.value=O(a,e,i,r.value)},H=async()=>{var a;if(!(!v.value||!u.id||!r.value)){if(!b.value||b.value.trim().length===0){k.value="Post name required.";return}try{await ie(D(A),{author:u.id,uid:u.uid,created:de.fromDate(new Date),title:b.value,subview:r.value,content:N.value}),(a=S.value)==null||a.hide()}catch(e){console.error(e),k.value="Something went wrong. Please try again later."}}},T=y(()=>{var a,e;return u.id&&((e=(a=_.value)==null?void 0:a.subscriptions)==null?void 0:e.indexOf(u.id))>-1}),M=async(a=!0)=>{if(!v||!r||!u.id)return;const e=D(L,r.value||""),i=await ue(e);if(!i.exists()){console.error("Cannot join - subview no longer exists");return}const P=i.data(),t=P.subscriptions||[];a?t.push(u.id):t.splice(t.indexOf(u.id),1);try{le(e,{members:(P.members||0)+(a?1:-1),subscriptions:t})}catch(c){console.error(c)}},$=d(1),I=a=>{$.value=a},J=y(()=>x.value?_e(x.value,$.value):[]);return(a,e)=>{const i=E("RouterLink"),P=E("RouterView");return n(),l(U,null,[C(F,null,{default:m(()=>[s(_)?(n(),l("div",ye,[C(i,{to:"/v/"+r.value},{default:m(()=>[o("h1",we,h(r.value),1)]),_:1},8,["to"]),o("span",he,[B("by "),C(i,{to:"/u/"+s(_).author},{default:m(()=>[B(h(s(_).author),1)]),_:1},8,["to"]),B(" â€¢ "+h(s(ce)(s(_).members||0,"member")),1)]),s(v)&&!T.value?(n(),l("button",{key:0,class:"btn btn-primary mx-2",onClick:e[0]||(e[0]=()=>M())},"Join")):p("",!0),s(v)&&T.value?(n(),l("button",{key:1,class:"btn btn-secondary mx-2",onClick:e[1]||(e[1]=()=>M(!1))},"Leave")):p("",!0),s(f).params.post?p("",!0):(n(),w(be,{key:2,class:"pt-2",pages:s(fe)(s(x)),onSearch:e[3]||(e[3]=(t,c,Q)=>G(t,c,Q)),onSetPage:e[4]||(e[4]=t=>I(t))},{default:m(()=>[o("button",{class:"btn btn-primary w-100",onClick:e[2]||(e[2]=t=>{var c;return(c=S.value)==null?void 0:c.show()})},"Create Post")]),_:1},8,["pages"]))])):g.value?p("",!0):(n(),l("div",ge,Pe))]),_:1}),C(Z,{id:"postModal",title:"Create Post"},{default:m(()=>[o("form",{onSubmit:oe(H,["prevent"])},[o("div",Ce,[Ne,j(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t),id:"postName",class:"form-control",name:"postName",placeholder:"Post Title"},null,512),[[q,b.value]]),k.value?(n(),l("small",De,h(k.value),1)):p("",!0)]),o("div",Be,[Se,j(o("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>N.value=t),id:"postBody",class:"form-control",name:"postBody",placeholder:"What are your thoughts?"},null,512),[[q,N.value]]),V.value?(n(),l("small",Ve,h(V.value),1)):p("",!0)]),Re],32)]),_:1}),s(f).params.post?(n(),w(P,{key:0})):g.value?(n(),w(ve,{key:1})):!g.value&&!s(x).length?(n(),w(F,{key:2},{default:m(()=>[Te,Me]),_:1})):(n(!0),l(U,{key:3},ee(J.value,t=>(n(),w(pe,{"post-id":t.id,subview:t.subview,title:`${t.title}`,date:s(me)(t.created)||new Date,author:`${t.author}`,body:`${t.content}`,score:t.score||0,vote:s(u).id?s(ae)(t.up||[],t.down||[],s(u).id):null},null,8,["post-id","subview","title","date","author","body","score","vote"]))),256))],64)}}});export{Fe as default};
